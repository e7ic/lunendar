# 农历计算规则

## 月相与太阳年
农历是阴阳合历，结合了月亮和太阳的运行周期，因此需要处理两部分内容：
- **朔望月**：每个月的开始基于月亮的相位变化，即朔（新月）。一个朔望月的平均长度为29.5306天。
- **太阳年**：一年是365.2422天，与二十四节气和四季相关。

#### 实现思路：
- 需要计算每个月的**朔日**（新月），即太阳与月亮同经度的那一天。
- 使用朔望月平均长度的天文数据计算月相，并依据这个长度安排农历的每个月。

可以通过天文观测公式或查阅天文数据获取朔日信息，使用一些高精度的浮点运算库或天文库来计算。

## 闰月的规则
农历的闰月规则是为了弥合阴历年（大约354天）与阳历年（365.24天）之间的差距。闰月规则较复杂，主要依据以下原则：
- 每2-3年添加一个闰月，使农历年平均与阳历年保持一致。
- 闰月是指某个农历年份中插入的第13个月，但该月与其前面的月份没有任何固定的顺序。
- **中气**：农历的月份与二十四节气配合，若某个月没有中气（太阳黄经在该月未达到30°、60°等位置），则这个月后会设立闰月。

#### 实现思路：
- 在实现时，计算每个农历月的中气，判断该月是否没有中气，如果没有中气，则为闰月。
- 闰月的插入算法需要根据天文计算得到中气的具体时间，并插入闰月。

实现过程中可以通过编写天文算法，或调用外部天文数据，判断每个月份是否需要插入闰月。

## 二十四节气
二十四节气与太阳在黄道上的位置有关，每15°一个节气。节气主要反映四季变化，影响农历月份的划分。
- 每年有24个节气，其中12个为“节”，12个为“中气”。中气与闰月规则有关。

#### 实现思路：
- 通过计算太阳的黄经（太阳在天球上的投影位置）来确定节气。根据太阳每经过15°，划分为一个节气（如立春、立夏、秋分、冬至等）。
- 可以基于天文算法或查询外部天文数据库，使用精确的日期和时间计算二十四节气。

## 60年干支纪年
农历使用干支纪年系统，即天干地支的组合。天干有10个（甲、乙、丙、丁、戊、己、庚、辛、壬、癸），地支有12个（子、丑、寅、卯、辰、巳、午、未、申、酉、戌、亥）。通过天干和地支的组合，每60年一个循环。

#### 实现思路：
- 以年份计算天干地支组合：天干按照10年循环，地支按12年循环。例如公历2024年是“甲辰年”，天干为甲，地支为辰。
- 可以通过以下公式计算天干和地支：
    - (年份 - 4) % 10 为年份所属天干的索引（从0开始）=> ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"]
    - (年份 - 4) % 12 为年份所属地支的索引（从0开始）=> ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]

## 朔日与日期转换
要完成公历和农历的转换，需要精确计算每个月的朔日，即新月开始的那天。利用天文算法，朔日是以黄道与月亮的相交点为依据。

#### 实现思路：
- 通过天文算法计算出每个月的朔日（公历日期），然后再根据这些朔日计算农历日期。
- 朔日的计算可以使用天文学常用的**儒略日（Julian Day）**，这是一种连续的时间表示法，从公元前4713年开始，用以计算天文现象发生的时间。
